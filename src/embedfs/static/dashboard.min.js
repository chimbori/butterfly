(()=>{function m(){function s(){A(),C()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",s):s()}async function A(){let s=document.getElementById("linkpreviews-domain-chart");if(s)try{let r=await fetch("/dashboard/link-previews/stats");if(!r.ok){console.error("Failed to fetch link preview statistics");return}let o=await r.json();if(o.length===0){console.log("No link preview data available");return}new Chart(s.getContext("2d"),{type:"doughnut",data:{labels:o.map(a=>a.Domain),datasets:[{data:o.map(a=>a.TotalAccesses),borderWidth:1}]},options:{responsive:!0,plugins:{legend:{position:"right",labels:{font:{size:14,family:"Inter"}}}}}})}catch(r){console.error("Error loading link preview chart:",r)}}function C(){let s=document.getElementById("linkpreviews-useragents-chart");if(!s)return;let r=document.getElementById("linkpreviews-useragents-range"),o=r?r.querySelectorAll("button[data-days]"):[],a=null,u=7;function g(n){o.forEach(t=>{let i=Number(t.dataset.days)===n;t.setAttribute("aria-pressed",i?"true":"false")})}function y(n){let t=new Set,i=new Set,c=new Map;n.forEach(e=>{t.add(e.Day),i.add(e.CanonicalUserAgent),c.set(e.CanonicalUserAgent,(c.get(e.CanonicalUserAgent)||0)+e.TotalAccesses)});let l=Array.from(t).sort(),f=Array.from(i).sort((e,d)=>(c.get(d)||0)-(c.get(e)||0)),p=new Map;n.forEach(e=>{let d=`${e.Day}::${e.CanonicalUserAgent}`;p.set(d,e.TotalAccesses)});let v=f.map((e,d)=>{let b=Math.round(d*360/Math.max(f.length,1));return{label:e,data:l.map(k=>p.get(`${k}::${e}`)||0),backgroundColor:`hsl(${b}, 65%, 55%)`}});return{labels:l,datasets:v}}async function h(n){try{let t=await fetch(`/dashboard/link-previews/user-agents?days=${n}`);if(!t.ok){console.error("Failed to fetch link preview user agent statistics");return}let i=await t.json();if(i.length===0){console.log("No user agent data available");return}let{labels:c,datasets:l}=y(i);if(a){a.data.labels=c,a.data.datasets=l,a.update();return}a=new Chart(s.getContext("2d"),{type:"bar",data:{labels:c,datasets:l},options:{responsive:!0,scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0}},plugins:{legend:{position:"bottom"}}}})}catch(t){console.error("Error loading user agent chart:",t)}}o.length>0&&o.forEach(n=>{n.addEventListener("click",()=>{let t=Number(n.dataset.days||7);Number.isNaN(t)||(u=t,g(t),h(t))})}),g(u),h(u)}m();})();
